<% title "#{@bowl.name}" %>

<div class="column" data-id="<%= @bowl.id %>">
  <div class="bowl_container">
    <% if !@bowl.scraps.empty? %>
      <%= link_to bowl_scrap_path(@bowl, @bowl.scraps.sample), class: "foo" do %>
        <div class="bowl"></div>
      <% end %>
    <% else %>
      <%= link_to new_bowl_scrap_path(@bowl), class: "foo" do %>
        <div class="bowl">
        </div>
      <% end %>
    <% end %>

    <a href="#" class="previous">&#8249;</a>
    <h2 class="bowl-name"><%= @bowl.name %></h2>
    <a href="#" class="next">&#8250;</a>

    <p><%= link_to "show scraps", "#", id: "show-scraps" %></p>

    <div id="scraps"></div>

    <p><%= link_to "edit bowl", edit_bowl_path %></p>
  </div>
</div>

<script type="text/javascript" charset="utf-8">
$(function() {
  let scrapResponse = "";
  const id = $(".column").data("id");

  function getScraps(id) {
    $.get("/bowls/" + id + ".json", function(response) {
      if (response.scraps.length == 0) {
        scrapResponse = `<p>This bowl has no scraps</p>`;
        scrapResponse += `<p><a href='./${id}/scraps/new'>add scrap</a></p>`;
      } else {
        $.each(response.scraps, function(index, value) {
          scrapResponse += `${value.description}</br>`;
        });
      };
      toggleScrapsLink();
    }); // get request
  };

  function toggleScrapsLink() {
    if ($("#show-scraps").html() == "show scraps") {
      $("#show-scraps").html("hide scraps");
      $("#scraps").html(scrapResponse);
    } else {
      $("#show-scraps").html("show scraps");
      $("#scraps").html("");
    }; // toggleScrapsLink
  };

  $("#show-scraps").click(function(event) {
    event.preventDefault();
    if (scrapResponse == "") {
      getScraps(id);
    } else {
      toggleScrapsLink();
    }
  }); // click #show-scraps event

  $(".previous").click(function(event) {
    event.preventDefault();
    // get previous bowl
    $.get("/bowls.json", function(response) {
      const thisBowlId = response.findIndex(function(element) {
        return element.id == id;
      });
      const previousBowl = response[thisBowlId-1];
      console.log("previousBowl: ");
      console.log(previousBowl);
      console.log("---");
      console.log("This bowl's name: ");
      console.log($('.bowl-name').html());
      console.log("---");
      console.log("This bowl's id: ");
      console.log($('div.column').attr('data-id'));
      console.log("---");
      console.log(previousBowl.id);
      console.log(previousBowl.name);

    });
  }); // click .previous event

}); // document ready
</script>
